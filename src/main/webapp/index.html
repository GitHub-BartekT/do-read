<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>do read</title>
            <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/purecss@3.0.0/build/pure-min.css"
          integrity="sha384-X38yfunGUhNzHpBaEBsWLO+A0HDYOQi8ufWDkZ0k9e0eXz/tH3II7uKZ9msv++Ls" crossorigin="anonymous">
</head>
<body>
<main style="width: 70%; margin: 0 auto">
    <div id="welcome" style="text-align: center">
        <h1><span style="color: #a81818">do read</span></h1>
    </div>

    <div id="Modules Properties" style="text-align: center">
        <h2>Modules Properties</h2>
    </div>

    <table id = "main table" >
        <tr>
            <td>
                <table id = 'buttons'>
                    <div class="pure-u">
                            <button class="pure-button pure-button-disabled">Show module</button>
                    </div>
                </table>
            </td>
            <td>
                <table id = "all-module-table" class="pure-table pure-table-bordered pure-table-striped" style="text-align: center">
                    <tr>
                        <td>id</td>
                        <td>module name</td>
                        <td>active</td>
                    </tr>
                </table>
            </td>
            <td>
                <table id = "module-properties-table" class="pure-table pure-table-bordered pure-table-striped" style="text-align: center">
                    <tr>
                        <td>id</td>
                        <td>Sessions per day</td>
                        <td>Presentations per session</td>
                        <td>new sentences per day</td>
                        <td>actual day</td>
                        <td>next session</td>
                        <td>change module</td>
                        <td>accept changes</td>
                    </tr>
                </table>
            </td>
        </tr>
    </table>

    <table class="pure-table pure-table-bordered" style="text-align: center" >
        <tr>
            <td>
                <h2>Module: </h2>
            </td>
            <td>
                <h2>
                    <div id="moduleNumber"></div>
                </h2>
            </td>
            <td>
                <h2>
                    <div id="moduleName"> </div>
                </h2>
            </td>
        </tr>
        <tr>
            <td>
                <form class="pure-form">
                    <input id="new sentence" class="pure-input-rounded pure-u-1"  placeholder="New sentence" />
                </form>
            </td>
            <td colspan="2">
                <button id="Add sentence btn" class="pure-button pure-button-primary">Add sentence</button>
            </td>
        </tr
        >
        <tr>
            <td>
                <h3>All words</h3>
            </td>
            <td colspan="2">
                <h3>Next session</h3>
            </td>
        </tr>
        <tr>
            <td>
                <ol>
                    <div id = "list"></div>
                </ol>
            </td>
            <td colspan="2" style="vertical-align: top">
                <ol>
                    <div id = "next session"></div>
                </ol>
            </td>
        </tr>
    </table>
</main>

<script>
    const API_URL = 'http://localhost:8080/api';
    const MODULE_API_URL = `${API_URL}/module`;

    fetch(`${API_URL}/allModules`)
        .then((response) => response.json())
        .then((modulesPropArr) => {
            modulesPropArr.map(s => {
                let table = document.getElementById('all-module-table');
                let row = table.insertRow(-1);
                newCellInRow(row, 0, s.id);
                newCellInRow(row, 1, s.module_Name);
                newCellInRow(row, 2, s.active);

                //TODO: merge to one function. ONE
                let tableButtons = document.getElementById('buttons');
                let rowButtons = tableButtons.insertRow(-1);
                let newCell = rowButtons.insertCell(0);
                const newButton = document.createElement("div");
                let newDiv = `<div>
                                        <style>
                                                .button-accept,
                                                .button-decline,
                                                 {
                                                    color: white;
                                                    border-radius: 4px;
                                                    text-shadow: 0 1px 1px rgba(0, 0, 0, 0.2);
                                                }

                                                .button-accept {
                                                    background: rgb(28, 184, 65);
                                                    /* this is a green */
                                                }

                                                .button-decline {
                                                    background: rgb(202, 60, 60);
                                                    /* this is a maroon */
                                                }
                                        </style>
                                    <button id=${s.id} class="pure-button" >${s.module_Name}</button>
                                </div>`;
                newButton.innerHTML = newDiv;
                newCell.appendChild(newButton);
            });
        });

    fetch(`${API_URL}/moduleProperties`)
        .then((response) => response.json())
        .then((modulesPropArr) => {
                modulesPropArr.map(s => {
                let table = document.getElementById('module-properties-table');
                let row = table.insertRow(-1);

                newCellInRow(row, 0, s.id);
                newCellInRow(row, 1, s.sessionsPerDay);
                newCellInRow(row, 2, s.presentationsPerSession);
                newCellInRow(row, 3, s.newSentencesPerDay);
                newCellInRow(row, 4, s.actualDay);
                newCellInRow(row, 5, s.nextSession);

                //TODO: merge to one function. ONE
                let newCell = row.insertCell(6);
                const newButton = document.createElement("div");
                let textChangeBtn = `changeBtn${s.id}`;
                let newDiv = ` <button id="${textChangeBtn}" class="pure-button pure-button-primary" >Change module</button>
                              `;
                newButton.innerHTML = newDiv;
                newCell.appendChild(newButton);

                //TODO: merge to one function. ONE
                let newChangeCell = row.insertCell(7);
                const newChangeButton = document.createElement("div");
                let textAcceptChangeBtn = `acceptChangesBtn${s.id}`;
                let newChangeDiv = `<button id="${textAcceptChangeBtn}" name="acceptChangesBtn" class="pure-button pure-button-disabled" >Acept changes</button>`;
                newChangeButton.innerHTML = newChangeDiv;
                newChangeCell.appendChild(newChangeButton);
            });
        });

    //TODO: changing buttons "Change module" => Decline
    const changeModuleButtons = document.getElementById('main table');
    const changeModuleButtonsPressed = e => {
        const isButton = e.target.nodeName === 'BUTTON';

        if(!isButton){ return}
        const formObj = {id: e.target.id};

        let rowID = `${e.target.id}`;
        let changeBtnID = "changeBtn" + rowID.substring(9);
        let acceptChangeBtnID = "acceptChangesBtn" + rowID.substring(9);

        //TODO: make if statment reading what is state of button
        document.getElementById(changeBtnID).innerText = "Decline";
        document.getElementById(`${e.target.id}`).classList.add("button-decline");

        document.getElementById(acceptChangeBtnID).classList.remove("pure-button-disabled");
        document.getElementById(acceptChangeBtnID).classList.add("pure-button-primary");
        document.getElementById(acceptChangeBtnID).classList.add("button-accept");

        document.getElementById('welcome').innerHTML = acceptChangeBtnID;
    }


    changeModuleButtons.addEventListener("click",changeModuleButtonsPressed);




    document.getElementById('Add sentence btn').addEventListener('click',addSentence);

    function addSentence(){
            const paramAddSentence = {
                sentence: document.getElementById('new sentence').value,
                module: document.getElementById('moduleNumber').innerHTML
            };

        fetch(`${MODULE_API_URL}`,
            {   method: 'Post',
                headers: {
                    'Accept': 'application/json',
                    'Content-Type': `application/json`
                },
                body: JSON.stringify(paramAddSentence)}
            )
            .then(processOkResponse)
            .then(addSentenceToList);
    }

    function addSentenceToList(){

        let newSentenceText = document.getElementById('new sentence').value;
        document.getElementById('list').innerHTML += `<li>${newSentenceText}</li>`
    }


    const moduleButtons = document.getElementById('buttons');
    const moduleButtonsPressed = e => {
        const isButton = e.target.nodeName === 'BUTTON';

        if(!isButton){ return}

        const formObj = {id: e.target.id};

        const formNextSession = {module: e.target.id};

        let button = document.getElementById(e.target.id);
        let text = button.innerText;

        document.getElementById('moduleNumber').innerText = e.target.id;

        fetch(`${MODULE_API_URL}?${new URLSearchParams(formNextSession)}`)
            .then((response) => response.json())
            .then((modulesArr) => {
                const list = modulesArr.map(s =>
                    `<li>${s.sentence}</li>`)
                    .join('\n');
                document.getElementById('next session').innerHTML = list;
            });

        document.getElementById("moduleName").innerText = text;
        fetch(`${MODULE_API_URL}?${new URLSearchParams(formObj)}`)
        .then((response) => response.json())
        .then((modulesArr) => {
            const list = modulesArr.map(s =>
                `<li>${s.sentence}</li>`)
                .join('\n');
            document.getElementById('list').innerHTML = list;
        });
    }

    moduleButtons.addEventListener("click", moduleButtonsPressed);



    function newCellInRow(row, int, text){
        let newCell = row.insertCell(int);
        let newText = document.createTextNode(text);
        newCell.appendChild(newText);
    }

    function processOkResponse(response = {}) {
        if (response.ok) {
            return response.json();
        }
        throw new Error(`Status not 200 (${response.status})`);
    }
    </script>
</body>
</html>


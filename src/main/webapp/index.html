<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>do read</title>
            <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/purecss@3.0.0/build/pure-min.css"
          integrity="sha384-X38yfunGUhNzHpBaEBsWLO+A0HDYOQi8ufWDkZ0k9e0eXz/tH3II7uKZ9msv++Ls" crossorigin="anonymous">
</head>
<body>
<main style="width: 70%; margin: 0 auto">
    <div id="welcome" style="text-align: center">
        <h1><span style="color: #a81818">do read</span></h1>
    </div>

    <div id="Modules Properties" style="text-align: center">
        <h2>Modules Properties</h2>
    </div>
    <table id = "main table" >
        <tr>
            <td>
                <table id = 'buttons'>
                    <tr>
                        <button class="pure-button pure-button-disabled">Show module</button>
                    </tr>
                </table>
            </td>
            <td>
                <table id = "all-module-table" class="pure-table pure-table-bordered pure-table-striped" style="text-align: center">
                    <tr>
                        <td>id</td>
                        <td>module name</td>
                        <td>active</td>
                    </tr>
                </table>
            </td>
            <td>
                <table id = "module-properties-table" class="pure-table pure-table-bordered pure-table-striped" style="text-align: center">
                    <tr>
                        <td>id</td>
                        <td>Sessions per day</td>
                        <td>Presentations per session</td>
                        <td>new sentences per day</td>
                        <td>actual day</td>
                        <td>next session</td>
                    </tr>
                </table>
            </td>
        </tr>
    </table>

    <table class="pure-table pure-table-bordered" style="text-align: center" >
        <tr>
            <td>
                <h2>Module: </h2>
            </td>
            <td>
                <h2>
                    <div id="moduleNumber"></div>
                </h2>
            </td>
            <td>
                <h2>
                    <div id="moduleName"> </div>
                </h2>
            </td>
        </tr>

        <tr>
            <td>
                <form class="pure-form">
                    <input id="new sentence" class="pure-input-rounded pure-u-1"  placeholder="New sentence" />
                </form>
            </td>
            <td colspan="2">
                <button id="Add sentence btn" class="pure-button pure-button-primary">Add sentence</button>
            </td>
        </tr
        >
        <tr>
            <td>
                <h3>All words</h3>
            </td>
            <td colspan="2">
                <h3>Next session</h3>
            </td>
        </tr>
        <tr>
            <td>
                <ol>
                    <div id = "list"></div>
                </ol>
            </td>
            <td colspan="2" style="vertical-align: top">
                <ol>
                    <div id = "next session"></div>
                </ol>
            </td>
        </tr>

    </table>
</main>

<script>
    const API_URL = 'http://localhost:8080/api';
    const MODULE_API_URL = `${API_URL}/module`;

    fetch(`${API_URL}/allModules`)
        .then((response) => response.json())
        .then((modulesPropArr) => {
            modulesPropArr.map(s => {
                let table = document.getElementById('all-module-table');
                let row = table.insertRow(-1);
                newCellInRow(row, 0, s.id);
                newCellInRow(row, 1, s.module_Name);
                newCellInRow(row, 2, s.active);

                let tableButtons = document.getElementById('buttons');
                let rowButtons = tableButtons.insertRow(-1);
                let newCell = rowButtons.insertCell(0);
                const newButton = document.createElement("div");
                let newDiv = `<button id=${s.id} class="pure-button" >${s.module_Name}</button>`;
                newButton.innerHTML = newDiv;
                newCell.appendChild(newButton);
            });
        });



    fetch(`${API_URL}/moduleProperties`)
        .then((response) => response.json())
        .then((modulesPropArr) => {
                modulesPropArr.map(s => {
                let table = document.getElementById('module-properties-table');
                let row = table.insertRow(-1);

                newCellInRow(row, 0, s.id);
                newCellInRow(row, 1, s.sessionsPerDay);
                newCellInRow(row, 2, s.presentationsPerSession);
                newCellInRow(row, 3, s.newSentencesPerDay);
                newCellInRow(row, 4, s.actualDay);
                newCellInRow(row, 5, s.nextSession);
            });
        });

    document.getElementById('Add sentence btn').addEventListener('click',addSentenceToList);

    //TODO: Frontend add new sentence btn, Backend fetch with date and read data
   /* function addSentence(){
        const paramAddSentence = {
            snetence: document.getElementById('new sentence').value,
            module: document.getElementById('new sentence').value
        };

    fetch(`${MODULE_API_URL}?${new URLSearchParams(formNextSession)}`)
    }
*/
    function addSentenceToList(){

        let newSentenceText = document.getElementById('new sentence').value;
        document.getElementById('list').innerHTML += `<li>${newSentenceText}</li>`
    }


    const moduleButtons = document.getElementById('buttons');

    const moduleButtonsPressed = e => {

        const isButton = e.target.nodeName === 'BUTTON';

        if(!isButton){
            return
        }

        const formObj = {
            id: e.target.id
        };

        const formNextSession = {
            module: e.target.id
        };

        let button = document.getElementById(e.target.id);
        let text = button.innerText;

        document.getElementById('moduleNumber').innerText = e.target.id;

        fetch(`${MODULE_API_URL}?${new URLSearchParams(formNextSession)}`)
            .then((response) => response.json())
            .then((modulesArr) => {
                const list = modulesArr.map(s =>
                    `<li>${s.sentence}</li>`)
                    .join('\n');
                document.getElementById('next session').innerHTML = list;
            });

        document.getElementById("moduleName").innerText = text;
        fetch(`${MODULE_API_URL}?${new URLSearchParams(formObj)}`)
        .then((response) => response.json())
        .then((modulesArr) => {
            const list = modulesArr.map(s =>
                `<li>${s.sentence}</li>`)
                .join('\n');
            document.getElementById('list').innerHTML = list;
        });

    }

    moduleButtons.addEventListener("click", moduleButtonsPressed);

    function newCellInRow(row, int, text){
        let newCell = row.insertCell(int);
        let newText = document.createTextNode(text);
        newCell.appendChild(newText);
    }
    </script>
</body>
</html>

